/*!
 * Copyright (c) 2012 Guillermo Winkler
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
(function(){var b=0;var a=Math.PI/180;function e(i,n,k,h,o,j,m){var s=o+(j-o)/2,l=n+h*Math.cos(-s*a),p=k+h*Math.sin(-s*a),q=i.text(l,p,m.text).attr({fill:m.fontColor,"font-size":m.fontSize});if(s>=90&&s<270){s+=180}q.transform("r"+(-s)+","+l+","+p);return q}function d(k,o,m,h,p,l,n){var j=o+h*Math.cos(-p*a),i=o+h*Math.cos(-l*a),s=m+h*Math.sin(-p*a),q=m+h*Math.sin(-l*a);var t=k.path(["M",o,m,"L",j,s,"A",h,h,0,+(l-p>180),0,i,q,"z"]).attr(n);e(k,o,m,h/2,p,l,n);return t}function f(q,m,k,y,x,w,u,C){var B=m+y*Math.cos(-w*a),l=k+y*Math.sin(-w*a),A=m+x*Math.cos(-w*a),j=k+x*Math.sin(-w*a),z=m+x*Math.cos(-u*a),i=k+x*Math.sin(-u*a),v=m+y*Math.cos(-u*a),h=k+y*Math.sin(-u*a);var r=q.path(["M",B,l,"L",A,j,"A",x,x,0,+(u-w>180),0,z,i,"L",v,h,"A",y,y,0,+(u-w>180),0,B,l,"z"]).attr(C);var p=e(q,m,k,(y+x)/2,w,u,C);var o=q.set();o.push(r,p);var n=function(){if(typeof(C.onClick)==="function"){o.toFront();C.onClick(r,C.text)}};var t=function(){r.attr({"fill-opacity":0.2})};var s=function(){r.attr({"fill-opacity":C["fill-opacity"]||1})};o.mouseover(t).mouseout(s).click(n);return o}function c(i,h,j){if(j.colors){if(j.colors.byCategory&&j.colors.byCategory[i]){return j.colors.byCategory[i]}if(j.colors.bySeries&&j.colors.bySeries[h]){return j.colors.bySeries[h]}}b+=1;return{color:Raphael.hsb(b,1,1)}}function g(n,i,h,u,m,p){var s=n.set();var q=0;var z={};var A;var k,v;for(k in m.data){if(m.data.hasOwnProperty(k)){q+=1;if(typeof(m.data[k])==="object"){z[k]=0;for(v in m.data[k]){if(m.data[k].hasOwnProperty(v)){z[k]+=1;if(!A||A<m.data[k][v]){A=m.data[k][v]}}}}}}var l=(p&&p.categorySize)||0.3;var t=0;var j=u*l;var o=360*(1/q);for(k in m.data){if(typeof(m.data[k])==="object"){d(n,i,h,j,t,t+o,{fill:m.colors.category,"fill-opacity":m.colors.opacity,text:k,fontSize:p.categoryFontSize,fontColor:m.colors.fontColor,stroke:p.stroke,"stroke-width":3});for(v in m.data[k]){var y=j+(u*(1-l)*(m.data[k][v]/A));var x=o/z[k];var w=c(k,v,m);f(n,i,h,j,y,t,t+x,{fill:w.color,stroke:p.stroke,hoverColor:w.hover,fontSize:p.seriesFontSize,fontColor:w.fontColor,text:v,"fill-opacity":w.opacity,"stroke-width":3,onClick:p.onClick});t+=x}}}}Raphael.fn.coxCombChart=function(h,l,j,k,i){return new g(this,h,l,j,k,i)}}());