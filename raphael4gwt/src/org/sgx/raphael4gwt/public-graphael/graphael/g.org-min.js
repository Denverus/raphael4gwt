function oc_render(){oc_calc();oc_draw()}if(navigator.appName=="Microsoft Internet Explorer"){var oc_IE=1}else{var oc_IE=0}var oc_max_text_width=0;var oc_max_text_height=0;var oc_max_title_lines=0;var oc_max_subtitle_lines=0;var oc_paper=null;function oc_clone(b){var a=(b instanceof Array)?[]:{};for(i in b){if(b[i]&&typeof b[i]=="object"){a[i]=oc_clone(b[i])}else{a[i]=b[i]}}return a}function oc_add2point(a,b){a[0]+=b[0];a[1]+=b[1]}function oc_repeat_str(d,c){var a="";for(var b=0;b<c-1;b++){a+=d}return a}function oc_calc(){oc_text_limit(oc_data.root);oc_delete_special_chars(oc_data.root);oc_text_dimensions(oc_data.root);oc_data.root.is_root=true;oc_boundboxes_dimensions(oc_data.root)}function oc_text_limit(b){if(oc_style.max_text_width==0){return}b.title=oc_text_limit_obj(b.title);b.subtitle=oc_text_limit_obj(b.subtitle);if(b.children===undefined){return}for(var a=0;a<b.children.length-(oc_IE);a++){oc_text_limit(b.children[a])}}function oc_text_limit_obj(g){if(g==undefined){return undefined}var f=g.split(/[ \n]+/);var b=[];var e="";var c="";for(var d=0;d<f.length-(0);d++){var c=e;e+=(d==0?"":" ")+f[d];if(e.length>oc_style.max_text_width){b.push(c);e=f[d]}}if(e!=""){b.push(e)}var a=b.join("\n");return a}function oc_delete_special_chars(b){b.title=oc_delete_special_chars_obj(b.title);b.subtitle=oc_delete_special_chars_obj(b.subtitle);if(b.children===undefined){return}for(var a=0;a<b.children.length-(oc_IE);a++){oc_delete_special_chars(b.children[a])}}function oc_delete_special_chars_obj(a){if(a===undefined){return undefined}a=a.replace(/á/g,"a");a=a.replace(/é/g,"e");a=a.replace(/í/g,"i");a=a.replace(/ó/g,"o");a=a.replace(/ú/g,"u");a=a.replace(/Á/g,"A");a=a.replace(/É/g,"E");a=a.replace(/Í/g,"I");a=a.replace(/Ó/g,"O");a=a.replace(/Ú/g,"U");a=a.replace(/ñ/g,"n");a=a.replace(/Ñ/g,"N");return a}function oc_text_dimensions(d){var a=[0,0];var c=[0,0];d.title_lines=d.subtitle_lines=0;a=oc_text_dimensions_obj(d.title,oc_style.title_char_size);d.title_lines=a[2];if(d.title_lines>oc_max_title_lines){oc_max_title_lines=d.title_lines}if(d.subtitle!==undefined){c=oc_text_dimensions_obj(d.subtitle,oc_style.subtitle_char_size);d.subtitle_lines=c[2];if(d.subtitle_lines>oc_max_subtitle_lines){oc_max_subtitle_lines=d.subtitle_lines}}if(a[0]>oc_max_text_width){oc_max_text_width=a[0]}if(oc_style.use_images&&oc_style.images_size[0]>oc_max_text_width){oc_max_text_width=oc_style.images_size[0]}if(c[0]>oc_max_text_width){oc_max_text_width=c[0]}if(a[1]+c[1]>oc_max_text_height){oc_max_text_height=a[1]+c[1]}if(d.children===undefined){return}for(var b=0;b<d.children.length-(oc_IE);b++){oc_text_dimensions(d.children[b])}}function oc_text_dimensions_obj(e,c){var b=0;var d=e.split("\n");if(d.length==0){return[0,0]}for(var a=0;a<d.length-(0);a++){if(d[a].length>b){b=d[a].length}}return[b*c[0],(d.length-(0))*c[1],d.length-(0)]}function oc_boundboxes_dimensions(l){if(l.type===undefined){l.type="subordinate"}l.deltacorner=[0,0];var q=0;var d=0;if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type=="staff"){f.position=(q++%2==0?"left":"right")}else{if(f.type=="collateral"){f.position=(d++%2==0?"left":"right")}}oc_boundboxes_dimensions(f)}}l.boundbox=[oc_max_text_width+2*oc_style.inner_padding,oc_max_text_height+2*oc_style.inner_padding];if(oc_style.use_images&&l.image!==undefined){l.boundbox[1]+=oc_style.inner_padding*1+oc_style.images_size[1]}var h=l.boundbox[1];if(l.is_root!==undefined){oc_add2point(l.boundbox,[2*oc_style.hline,2*oc_style.vline]);l.deltacenter=[l.boundbox[0]/2,h/2+2*oc_style.vline]}else{if(l.type=="collateral"){oc_add2point(l.boundbox,[2*oc_style.hline,2*oc_style.vline]);l.deltacenter=[l.boundbox[0]/2,h/2+2*oc_style.vline]}else{if(l.type=="staff"){oc_add2point(l.boundbox,[2*oc_style.hline,1*oc_style.vline]);l.deltacenter=[l.boundbox[0]/2,h/2+1*oc_style.vline]}else{oc_add2point(l.boundbox,[2*oc_style.hline,2*oc_style.vline]);l.deltacenter=[l.boundbox[0]/2,h/2+2*oc_style.vline]}}}l.fullbbox=oc_clone(l.boundbox);if(l.children===undefined){l.xoffset=0}var p=l.boundbox[0]/2;var u=l.boundbox[0]/2;var e=0;if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="collateral"){continue}e++;if(f.position=="left"){p=f.fullbbox[0]+l.boundbox[0]/2}else{u=f.fullbbox[0]+l.boundbox[0]/2}}}var b=0;var r=0;var o=0;var c=0;var g=0;var m=0;if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="staff"){continue}m++;if(f.position=="left"){b+=f.fullbbox[1];r=f.fullbbox[1];if(c<f.fullbbox[0]){c=f.fullbbox[0]}}else{r=f.fullbbox[1];if(f.fullbbox[1]>r){b+=f.fullbbox[1]-r}if(g<f.fullbbox[0]){g=f.fullbbox[0]}}}}var s=0;if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="subordinate"){continue}s+=f.fullbbox[0]}}var t=0;if(p>t){t=p}if(c>t){t=c}if(s/2>t){t=s/2}var k=0;if(u>k){k=u}if(g>k){k=g}if(s/2>k){k=s/2}l.xoffset=t-l.boundbox[0]/2;if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="collateral"){continue}if(f.position=="left"){f.deltacorner=[t-l.boundbox[0]/2-f.fullbbox[0],0]}else{f.deltacorner=[t+l.boundbox[0]/2,0]}oc_update_fullbbox(l,f)}}b=0;r=0;o=0;if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="staff"){continue}if(f.position=="left"){f.deltacorner=[t-f.fullbbox[0],l.boundbox[1]+b];b+=f.fullbbox[1];r=f.fullbbox[1];if(m==1){l.fullbbox[0]+=l.boundbox[0]}}else{f.deltacorner=[t,l.boundbox[1]+o];r=f.fullbbox[1];if(f.fullbbox[1]>r){b+=f.fullbbox[1]-r}}oc_update_fullbbox(l,f)}}var j=0;var a=t-s/2;if(a<0){a=0}if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="subordinate"){continue}f.deltacorner=[a+j,l.boundbox[1]+b];j+=f.fullbbox[0]}for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];if(f.type!="subordinate"){continue}oc_update_fullbbox(l,f)}}if(OC_DEBUG){if(l.children!==undefined){for(var n=0;n<l.children.length-(oc_IE);n++){var f=l.children[n];console.log("oc_boundboxes_dimensions ["+f.title+"] boundbox("+f.boundbox[0]+","+f.boundbox[1]+") deltacenter("+f.deltacenter[0]+","+f.deltacenter[1]+") fullbbox("+f.fullbbox[0]+","+f.fullbbox[1]+") deltacorner("+f.deltacorner[0]+","+f.deltacorner[1]+") xoffset("+f.xoffset+")")}}}}function oc_update_fullbbox(e,f){var b=0,d=0,a=e.fullbbox[0],c=e.fullbbox[1];if(f.deltacorner[0]<b){b=f.deltacorner[0]}if(f.deltacorner[0]+f.fullbbox[0]>a){a=f.deltacorner[0]+f.fullbbox[0]}if(f.deltacorner[1]+f.fullbbox[1]>c){c=f.deltacorner[1]+f.fullbbox[1]}if(b<e.deltacorner[0]){e.deltacorner[0]=b}if(OC_DEBUG){console.log("updatefullbbox "+e.title+" <-- "+f.title+" x0="+b+" x1="+a+" y0="+d+" y1="+c)}e.fullbbox=[a-b,c-d]}function oc_draw(){oc_paper=new Raphael(document.getElementById(oc_style.container),oc_data.root.fullbbox[0],oc_data.root.fullbbox[1]);oc_draw_obj(oc_data.root,null,0,0)}function oc_draw_obj(t,k,p,o){if(t.children!==undefined){for(var x=0;x<t.children.length-(oc_IE);x++){oc_draw_obj(t.children[x],t,t.deltacorner[0]+p,t.deltacorner[1]+o)}}if(OC_DEBUG){console.log("drawing "+t.title+": legacyXoff="+p+" legacyYoff="+o+" dcornerX="+t.deltacorner[0]+" dcornerY="+t.deltacorner[1]+" dcenterX="+t.deltacenter[0]+" dcenterY="+t.deltacenter[1]+" xoff="+t.xoffset)}var v=p+t.deltacorner[0]+t.deltacenter[0]+t.xoffset;var c=o+t.deltacorner[1]+t.deltacenter[1];var B=v-oc_max_text_width/2-oc_style.inner_padding;var A=v+oc_max_text_width/2+oc_style.inner_padding;if(oc_style.use_images&&t.image!==undefined){var g=c-oc_max_text_height/2-oc_style.inner_padding-oc_style.images_size[1]/2-oc_style.inner_padding/2;var f=c+oc_max_text_height/2+oc_style.inner_padding+oc_style.images_size[1]/2+oc_style.inner_padding/2}else{var g=c-oc_max_text_height/2-oc_style.inner_padding;var f=c+oc_max_text_height/2+oc_style.inner_padding}var m=oc_paper.rect(B,g,A-B,f-g);m.attr("fill",oc_style.box_color);m.attr("stroke",oc_style.box_border_color);if(t.id!==undefined){m.oc_id=t.id}m.hover(function(D){this.attr({fill:oc_style.box_color_hover})},function(D){this.attr({fill:oc_style.box_color})});if(oc_style.box_click_handler!==null){m.click(function(D){oc_style.box_click_handler(D,m)})}var s=g+oc_style.inner_padding+t.title_lines*oc_style.title_char_size[1]/2+(oc_max_title_lines-t.title_lines)*oc_style.title_char_size[1]/2-2;var C=oc_paper.text(v,s,t.title);C.attr("font-family",oc_style.text_font);C.attr("font-size",oc_style.title_font_size);C.attr("fill",oc_style.title_color);if(t.subtitle!==undefined){var b=f-oc_style.inner_padding-t.subtitle_lines*oc_style.subtitle_char_size[1]/2;var h=oc_paper.text(v,b,t.subtitle);h.attr("font-family",oc_style.text_font);h.attr("font-size",oc_style.subtitle_font_size);h.attr("fill",oc_style.subtitle_color)}if(oc_style.use_images&&t.image!==undefined){var q=oc_paper.image(oc_style.images_base_url+t.image,v-oc_style.images_size[0]/2,f-oc_style.images_size[1]-oc_style.inner_padding,oc_style.images_size[0],oc_style.images_size[1])}if(k!=null){var u=v-t.xoffset-t.deltacorner[0]+k.xoffset+(0-0);var a=c-0-t.deltacorner[1]+0+(k.deltacenter[1]-t.deltacenter[1]);var y=u-oc_max_text_width/2-oc_style.inner_padding;var w=u+oc_max_text_width/2+oc_style.inner_padding;var e=a-oc_max_text_height/2-oc_style.inner_padding;var d=a+oc_max_text_height/2+oc_style.inner_padding;var n,l;if(t.type=="collateral"){if(t.position=="left"){var r="M "+A+" "+c+" l "+(2*oc_style.hline)+" 0";n=oc_paper.path(r);l=oc_paper.path(r)}else{var r="M "+B+" "+c+" l -"+(2*oc_style.hline)+" 0";n=oc_paper.path(r);l=oc_paper.path(r)}}else{if(t.type=="staff"){if(t.position=="left"){var r="M "+A+" "+c+" h "+(u-A)+" v "+(a-c);n=oc_paper.path(r);l=oc_paper.path(r)}else{var r="M "+B+" "+c+" h "+(u-B)+" v "+(a-c);n=oc_paper.path(r);l=oc_paper.path(r)}}else{if(t.is_root===undefined){var r="M "+v+" "+g+" v -"+oc_style.vline+" h "+(u-v)+" V "+d;n=oc_paper.path(r);l=oc_paper.path(r)}}}n.attr("stroke",oc_style.line_color);l.attr("stroke",oc_style.line_color)}if(OC_DEBUG){B=p+t.deltacorner[0]+t.xoffset;A=p+t.deltacorner[0]+t.xoffset+t.boundbox[0];g=o+t.deltacorner[1];f=o+t.deltacorner[1]+t.boundbox[1];var j=oc_paper.rect(B+4,g+4,A-B-8,f-g-6);j.attr({stroke:"#00f","stroke-width":0.4});B=p+t.deltacorner[0];A=p+t.deltacorner[0]+t.fullbbox[0];g=o+t.deltacorner[1];f=o+t.deltacorner[1]+t.fullbbox[1];var z=oc_paper.rect(B+2,g+2,A-B-4,f-g-2);z.attr({stroke:"#f00","stroke-width":0.4})}};