/*! raphael4gwt 2013-08-26 */
function GanttChart(a){this.elementId=a,this.height=500,this.width=500,this.gridSize=25,this.labelAreaSize=250,this.currentRow=1,this.phaseColor="#AAA",this.taskColors=["#C24704","#D9CC3C","#FFEB79","#A0E0A9","#00ADA7"],this.cellpadding=4;var b=0;this.loadData=function(a){this.project=a},this.draw=function(){var a=this.getDates();width=this.labelAreaSize+a.length*this.gridSize;var c=this.getRows();height=c*this.gridSize,this.paper=Raphael(this.elementId,width,height),this.grid(),this.headers(a);var d=this.project[0].phases;for(p in d){var e=this.paper.text(5,this.currentRow*this.gridSize+this.gridSize/2,d[p].name);e.attr({"font-size":14,stroke:"none",fill:"black","text-anchor":"start"}),this.phaseLine(d[p]),this.currentRow++;var f=d[p].tasks;for(t in f)this.bar(f[t]),this.currentRow++;b<this.taskColors.length?b++:b=0}},this.getRows=function(){var a=this.project[0].phases,b=1;for(p in a){b++;var c=a[p].tasks;for(t in c)b++}return b},this.grid=function(){for(var a=this.gridSize;height>a;a+=this.gridSize){var b="M0,"+a+"L"+width+","+a,c=this.paper.path(b);c.attr({stroke:"#000"})}for(var d=this.labelAreaSize;width>d;d+=this.gridSize)var b="M"+d+",0L"+d+","+height,c=this.paper.path(b)},this.headers=function(a){var b=0;for(d in a){var c=this.paper.text(this.labelAreaSize+b*this.gridSize+.5*this.gridSize,.5*this.gridSize,a[d].format("M-D"));c.attr({"text-anchor":"middle"}),b++}},this.phaseLine=function(a){var b=this.getDates(),c=moment(a.startDate),d=moment(a.endDate);d.add("days",1);var e=moment.duration(c-b[0]),f=e.asDays()*this.gridSize+this.labelAreaSize+this.cellpadding,g=this.currentRow*this.gridSize+.25*this.gridSize,h=moment.duration(d-c),i=h.asDays()*this.gridSize-2*this.cellpadding,j=this.gridSize/4,k=this.paper.rect(f,g,i,j);k.attr({stroke:this.phaseColor}),k.attr({fill:this.phaseColor});var l=f+","+g,m=f+","+(g+.75*this.gridSize-this.cellpadding),n=f+.5*this.gridSize+","+g,o=this.paper.path("M"+l+"L"+m+"L"+n+"Z");o.attr({stroke:this.phaseColor,fill:this.phaseColor});var l=f+i+","+g,m=f+i+","+(g+.75*this.gridSize-this.cellpadding),n=f+i-.5*this.gridSize+","+g,p=this.paper.path("M"+l+"L"+m+"L"+n+"Z");p.attr({stroke:this.phaseColor,fill:this.phaseColor})},this.bar=function(a){var c=this.getDates(),d=moment(a.startDate),e=moment(a.endDate);e.add("days",1);var f=moment.duration(d-c[0]),g=f.asDays()*this.gridSize+this.labelAreaSize,h=this.currentRow*this.gridSize,i=moment.duration(e-d),j=i.asDays()*this.gridSize,k=this.gridSize,l=this.paper.rect(g+this.cellpadding,h+this.cellpadding,j-2*this.cellpadding,k-2*this.cellpadding),m=this.paper.text(10,h+k/2,a.name);m.attr({"font-size":14,stroke:"none",fill:"black","text-anchor":"start"});var n=this.taskColors[b],o=Raphael.color(n);l.attr({fill:o});var p,q=this.cellpadding;l.hover(function(){p=l.glow({width:q,opacity:.75,color:o})},function(){p.remove()})},this.getDates=function(){for(var a=moment(this.project[0].startDate),b=moment(this.project[0].endDate),c=[];b>=a;)c.push(a.clone()),a.add("days",1);return c}}